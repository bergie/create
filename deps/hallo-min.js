// Generated by CoffeeScript 1.3.3
/*
Hallo 1.0.1dev - a rich text editing jQuery UI widget
(c) 2011 Henri Bergius, IKS Consortium
Hallo may be freely distributed under the MIT license
http://hallojs.org
*/((function(){(function(a){return a.widget("IKS.hallo",{toolbar:null,bound:!1,originalContent:"",previousContent:"",uuid:"",selection:null,_keepActivated:!1,originalHref:null,options:{editable:!0,plugins:{},toolbar:"halloToolbarContextual",parentElement:"body",buttonCssClass:null,placeholder:"",forceStructured:!0,checkTouch:!0,touchScreen:null},_create:function(){var b,c,d,e=this;this.id=this._generateUUID(),this.options.checkTouch&&this.options.touchScreen===null&&this.checkTouch(),d=this.options.plugins;for(c in d)b=d[c],a.isPlainObject(b)||(b={}),a.extend(b,{editable:this,uuid:this.id,buttonCssClass:this.options.buttonCssClass}),a(this.element)[c](b);return this.element.one("halloactivated",function(){return e._prepareToolbar()}),this.originalContent=this.getContents()},_init:function(){return this.options.editable?this.enable():this.disable()},disable:function(){var b=this;return this.element.attr("contentEditable",!1),this.element.unbind("focus",this._activated),this.element.unbind("blur",this._deactivated),this.element.unbind("keyup paste change",this._checkModified),this.element.unbind("keyup",this._keys),this.element.unbind("keyup mouseup",this._checkSelection),this.bound=!1,a(this.element).removeClass("isModified"),this.element.parents("a").andSelf().each(function(c,d){var e;e=a(d);if(!e.is("a"))return;if(!b.originalHref)return;return e.attr("href",b.originalHref)}),this._trigger("disabled",null)},enable:function(){var b,c=this;return this.element.parents("a[href]").andSelf().each(function(b,d){var e;e=a(d);if(!e.is("a[href]"))return;return c.originalHref=e.attr("href"),e.removeAttr("href")}),this.element.attr("contentEditable",!0),this.element.html()||this.element.html(this.options.placeholder),this.bound||(this.element.bind("focus",this,this._activated),this.element.bind("blur",this,this._deactivated),this.element.bind("keyup paste change",this,this._checkModified),this.element.bind("keyup",this,this._keys),this.element.bind("keyup mouseup",this,this._checkSelection),b=this,this.bound=!0),this.options.forceStructured&&this._forceStructured(),this._trigger("enabled",null)},activate:function(){return this.element.focus()},containsSelection:function(){var a;return a=this.getSelection(),this.element.has(a.startContainer).length>0},getSelection:function(){var a,b;return b=rangy.getSelection(),a=null,b.rangeCount>0?a=b.getRangeAt(0):a=rangy.createRange(),a},restoreSelection:function(a){var b;return b=rangy.getSelection(),b.setSingleRange(a)},replaceSelection:function(b){var c,d,e,f,g;return a.browser.msie?(g=document.selection.createRange().text,d=document.selection.createRange(),d.pasteHTML(b(g))):(f=window.getSelection(),e=f.getRangeAt(0),c=document.createTextNode(b(e.extractContents())),e.insertNode(c),e.setStartAfter(c),f.removeAllRanges(),f.addRange(e))},removeAllSelections:function(){return a.browser.msie?range.empty():window.getSelection().removeAllRanges()},getContents:function(){var b,c;b=this.element.clone();for(c in this.options.plugins)a(this.element)[c]("cleanupContentClone",b);return b.html()},setContents:function(a){return this.element.html(a)},isModified:function(){return this.previousContent||(this.previousContent=this.originalContent),this.previousContent!==this.getContents()},setUnmodified:function(){return this.previousContent=this.getContents()},setModified:function(){return a(this.element).addClass("isModified"),this._trigger("modified",null,{editable:this,content:this.getContents()})},restoreOriginalContent:function(){return this.element.html(this.originalContent)},execute:function(a,b){if(document.execCommand(a,!1,b))return this.element.trigger("change")},protectFocusFrom:function(a){var b;return b=this,a.bind("mousedown",function(a){return a.preventDefault(),b._protectToolbarFocus=!0,setTimeout(function(){return b._protectToolbarFocus=!1},300)})},keepActivated:function(a){this._keepActivated=a},_generateUUID:function(){var a;return a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},""+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},_prepareToolbar:function(){var b;this.toolbar=a('<div class="hallotoolbar"></div>').hide(),a(this.element)[this.options.toolbar]({editable:this,parentElement:this.options.parentElement,toolbar:this.toolbar});for(b in this.options.plugins)a(this.element)[b]("populateToolbar",this.toolbar);return a(this.element)[this.options.toolbar]("setPosition"),this.protectFocusFrom(this.toolbar)},_checkModified:function(a){var b;b=a.data;if(b.isModified())return b.setModified()},_keys:function(a){var b,c;c=a.data;if(a.keyCode===27)return b=c.getContents(),c.restoreOriginalContent(a),c._trigger("restored",null,{editable:c,content:c.getContents(),thrown:b}),c.turnOff()},_rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},_checkSelection:function(a){var b;if(a.keyCode===27)return;return b=a.data,setTimeout(function(){var c;c=b.getSelection();if(b._isEmptySelection(c)||b._isEmptyRange(c)){b.selection&&(b.selection=null,b._trigger("unselected",null,{editable:b,originalEvent:a}));return}if(!b.selection||!b._rangesEqual(c,b.selection))return b.selection=c.cloneRange(),b._trigger("selected",null,{editable:b,selection:b.selection,ranges:[b.selection],originalEvent:a})},0)},_isEmptySelection:function(a){return a.type==="Caret"?!0:!1},_isEmptyRange:function(a){return a.collapsed?!0:a.isCollapsed?typeof a.isCollapsed=="function"?a.isCollapsed():a.isCollapsed:!1},turnOn:function(){return this.getContents()===this.options.placeholder&&this.setContents(""),a(this.element).addClass("inEditMode"),this._trigger("activated",this)},turnOff:function(){a(this.element).removeClass("inEditMode"),this._trigger("deactivated",this);if(!this.getContents())return this.setContents(this.options.placeholder)},_activated:function(a){return a.data.turnOn()},_deactivated:function(b){if(b.data._keepActivated)return;return b.data._protectToolbarFocus!==!0?b.data.turnOff():setTimeout(function(){return a(b.data.element).focus()},300)},_forceStructured:function(a){try{return document.execCommand("styleWithCSS",0,!1)}catch(b){try{return document.execCommand("useCSS",0,!0)}catch(b){try{return document.execCommand("styleWithCSS",!1,!1)}catch(b){}}}},checkTouch:function(){return this.options.touchScreen="createTouch"in document}})})(jQuery),function(a){return a.widget("IKS.halloindicator",{options:{editable:null,className:"halloEditIndicator"},_create:function(){var b;return b=a('<div><i class="icon-edit"></i> Edit</div>'),b.addClass(this.options.className),b.hide(),this.element.before(b),this.bindIndicator(b),this.setIndicatorPosition(b)},bindIndicator:function(b){var c=this;return b.bind("click",function(){return c.options.editable.element.focus()}),this.element.bind("halloactivated",function(){return b.hide()}),this.options.editable.element.hover(function(){if(a(this).hasClass("inEditMode"))return;return b.show()},function(c){if(a(this).hasClass("inEditMode"))return;if(c.relatedTarget===b.get(0))return;return b.hide()})},setIndicatorPosition:function(a){var b;return a.css("position","absolute"),b=this.element.position(),a.css("top",b.top+2),a.css("left",b.left+2)}})}(jQuery),function(a){return a.widget("IKS.hallolists",{options:{editable:null,toolbar:null,uuid:"",lists:{ordered:!0,unordered:!0},buttonCssClass:null},populateToolbar:function(b){var c,d,e=this;return d=a('<span class="'+this.widgetName+'"></span>'),c=function(b,c){var f;return f=a("<span></span>"),f.hallobutton({uuid:e.options.uuid,editable:e.options.editable,label:c,command:"insert"+b+"List",icon:"icon-list-"+c.toLowerCase(),cssClass:e.options.buttonCssClass}),d.append(f)},this.options.lists.ordered&&c("Ordered","OL"),this.options.lists.unordered&&c("Unordered","UL"),d.hallobuttonset(),b.append(d)}})}(jQuery),function(a){return a.widget("IKS.halloheadings",{options:{editable:null,toolbar:null,uuid:"",headers:[1,2,3]},populateToolbar:function(b){var c,d,e,f,g,h,i,j,k,l,m=this;i=this,e=a('<span class="'+i.widgetName+'"></span>'),g=""+this.options.uuid+"-paragraph",h="P",e.append(a('<input id="'+g+'" type="radio" name="'+i.options.uuid+'-headings"/><label for="'+g+'" class="p_button">'+h+"</label>").button()),c=a("#"+g,e),c.attr("hallo-command","formatBlock"),c.bind("change",function(b){var c;return c=a(this).attr("hallo-command"),i.options.editable.execute(c,"P")}),d=function(b){return h="H"+b,g=""+m.options.uuid+"-"+b,e.append(a('<input id="'+g+'" type="radio" name="'+i.options.uuid+'-headings"/><label for="'+g+'" class="h'+b+'_button">'+h+"</label>").button()),c=a("#"+g,e),c.attr("hallo-size","H"+b),c.bind("change",function(b){var c;return c=a(this).attr("hallo-size"),i.options.editable.execute("formatBlock",c)})},l=this.options.headers;for(j=0,k=l.length;j<k;j++)f=l[j],d(f);return e.buttonset(),this.element.bind("keyup paste change mouseup",function(b){var c,d,f,g,h;try{c=document.queryCommandValue("formatBlock").toUpperCase()}catch(j){c=""}if(c==="P")h=a("#"+i.options.uuid+"-paragraph");else if(g=c.match(/\d/))d=g[0],h=a("#"+i.options.uuid+"-"+d);f=a(e),f.children("input").attr("checked",!1),f.children("label").removeClass("ui-state-clicked"),f.children("input").button("widget").button("refresh");if(h)return h.attr("checked",!0),h.next("label").addClass("ui-state-clicked"),h.button("refresh")}),b.append(e)},_init:function(){}})}(jQuery),function(a){return a.widget("Liip.hallooverlay",{options:{editable:null,toolbar:null,uuid:"",overlay:null,padding:10,background:null},_create:function(){var b;b=this;if(!this.options.bound)return this.options.bound=!0,b.options.editable.element.bind("halloactivated",function(c,d){b.options.currentEditable=a(c.target);if(!b.options.visible)return b.showOverlay()}),b.options.editable.element.bind("hallomodified",function(c,d){b.options.currentEditable=a(c.target);if(b.options.visible)return b.resizeOverlay()}),b.options.editable.element.bind("hallodeactivated",function(c,d){b.options.currentEditable=a(c.target);if(b.options.visible)return b.hideOverlay()})},_init:function(){},showOverlay:function(){return this.options.visible=!0,this.options.overlay===null&&(a("#halloOverlay").length>0?this.options.overlay=a("#halloOverlay"):(this.options.overlay=a('<div id="halloOverlay" class="halloOverlay">'),a(document.body).append(this.options.overlay)),this.options.overlay.bind("click",a.proxy(this.options.editable.turnOff,this.options.editable))),this.options.overlay.show(),this.options.background===null&&(a("#halloBackground").length>0?this.options.background=a("#halloBackground"):(this.options.background=a('<div id="halloBackground" class="halloBackground">'),a(document.body).append(this.options.background))),this.resizeOverlay(),this.options.background.show(),this.options.originalZIndex||(this.options.originalZIndex=this.options.currentEditable.css("z-index")),this.options.currentEditable.css("z-index","350")},resizeOverlay:function(){var a;return a=this.options.currentEditable.offset(),this.options.background.css({top:a.top-this.options.padding,left:a.left-this.options.padding}),this.options.background.width(this.options.currentEditable.width()+2*this.options.padding),this.options.background.height(this.options.currentEditable.height()+2*this.options.padding)},hideOverlay:function(){return this.options.visible=!1,this.options.overlay.hide(),this.options.background.hide(),this.options.currentEditable.css("z-index",this.options.originalZIndex)},_findBackgroundColor:function(a){var b;return b=a.css("background-color"),b!=="rgba(0, 0, 0, 0)"&&b!=="transparent"?b:a.is("body")?"white":this._findBackgroundColor(a.parent())}})}(jQuery),function(a){return a.widget("IKS.halloimagecurrent",{options:{imageWidget:null,startPlace:"",draggables:[],maxWidth:400,maxHeight:200},_create:function(){return this.element.html('<div>        <div class="activeImageContainer">          <div class="rotationWrapper">            <div class="hintArrow"></div>              <img src="" class="activeImage" />            </div>            <img src="" class="activeImage activeImageBg" />          </div>          <div class="metadata" style="display: none;">            <input type="text" class="caption" name="caption" />          </div>        </div>'),this.element.hide(),this._prepareDnD()},_init:function(){var b,c;return b=a(this.options.editable.element),c=this,a("img",b).each(function(a,d){return d.contentEditable=!1,c._initDraggable(d,b)}),a("p",b).each(function(b,d){if(a(d).data("jquery_droppable_initialized"))return;return a(d).droppable({tolerance:"pointer",drop:function(a,b){return c._handleDropEvent(a,b)},over:function(a,b){return c._handleOverEvent(a,b)},out:function(a,b){return c._handleLeaveEvent(a,b)}}),a(d).data("jquery_droppable_initialized",!0)})},_prepareDnD:function(){var b,c,d;return d=this,b=a(this.options.editable.element),this.options.offset=b.offset(),this.options.third=parseFloat(b.width()/3),c={width:this.options.third,height:b.height()},this.overlay={big:a("<div/>").addClass("bigOverlay").css({width:this.options.third*2,height:b.height()}),left:a("<div/>").addClass("smallOverlay smallOverlayLeft").css(c),right:a("<div/>").addClass("smallOverlay smallOverlayRight").css(c).css("left",this.options.third*2)},b.bind("halloactivated",function(){return d._enableDragging()}),b.bind("hallodeactivated",function(){return d._disableDragging()})},setImage:function(b){if(!b)return;return this.element.show(),a(".activeImage",this.element).attr("src",b.url),b.label&&(a("input",this.element).val(b.label),a(".metadata",this.element).show()),this._initImage(a(this.options.editable.element))},_delayAction:function(a,b){var c;c=clearTimeout(c);if(!c)return c=setTimeout(a,b)},_calcDropPosition:function(a,b){var c;c=a.left+this.options.third;if(b.pageX>=c&&b.pageX<=a.left+this.options.third*2)return"middle";if(b.pageX<c)return"left";if(b.pageX>a.left+this.options.third*2)return"right"},_createInsertElement:function(b,c){var d,e,f,g;return d=a("<img>"),g=new Image,f=this.options.maxWidth,e=this.options.maxHeight,a(g).bind("load",function(){var a,b,c;c=g.width,a=g.height;if(c>f||a>e)c>a?b=(g.width/f).toFixed():b=(g.height/e).toFixed(),c=(g.width/b).toFixed(),a=(g.height/b).toFixed();return d.attr({width:c,height:a})}),g.src=b.src,d.attr({src:g.src,alt:c?void 0:a(b).attr("alt"),"class":c?"halloTmp":""}),d.show(),d},_createLineFeedbackElement:function(){return a("<div/>").addClass("halloTmpLine")},_removeFeedbackElements:function(){return a(".halloTmp, .halloTmpLine",this.options.editable.element).remove()},_removeCustomHelper:function(){return a(".customHelper").remove()},_showOverlay:function(b){var c,d;d=a(this.options.editable.element),c=d.height()+parseFloat(d.css("paddingTop"))+parseFloat(d.css("paddingBottom")),this.overlay.big.css({height:c}),this.overlay.left.css({height:c}),this.overlay.right.css({height:c});switch(b){case"left":return this.overlay.big.addClass("bigOverlayLeft").removeClass("bigOverlayRight").css({left:this.options.third}).show(),this.overlay.left.hide(),this.overlay.right.hide();case"middle":return this.overlay.big.removeClass("bigOverlayLeft bigOverlayRight"),this.overlay.big.hide(),this.overlay.left.show(),this.overlay.right.show();case"right":return this.overlay.big.addClass("bigOverlayRight").removeClass("bigOverlayLeft").css({left:0}).show(),this.overlay.left.hide(),this.overlay.right.hide()}},_checkOrigin:function(b){return a(b.target).parents("[contenteditable]").length!==0?!0:!1},_createTmpFeedback:function(a,b){var c;return b==="middle"?this._createLineFeedbackElement():(c=this._createInsertElement(a,!0),c.addClass("inlineImage-"+b))},_handleOverEvent:function(b,c){var d,e,f;return f=this,d=a(this.options.editable),e=function(){var e;return window.waitWithTrash=clearTimeout(window.waitWithTrash),e=f._calcDropPosition(f.options.offset,b),a(".trashcan",c.helper).remove(),d.append(f.overlay.big),d.append(f.overlay.left),d.append(f.overlay.right),f._removeFeedbackElements(),a(b.target).prepend(f._createTmpFeedback(c.draggable[0],e)),e==="middle"?(a(b.target).prepend(f._createTmpFeedback(c.draggable[0],"right")),a(".halloTmp",b.target).hide()):(a(b.target).prepend(f._createTmpFeedback(c.draggable[0],"middle")),a(".halloTmpLine",b.target).hide()),f._showOverlay(e)},setTimeout(e,5)},_handleDragEvent:function(b,c){var d,e,f;d=this._calcDropPosition(this.options.offset,b);if(d===this._lastPositionDrag)return;return this._lastPositionDrag=d,e=a(".halloTmp",this.options.editable.element),f=a(".halloTmpLine",this.options.editable.element),d==="middle"?(f.show(),e.hide()):(f.hide(),e.removeClass("inlineImage-left inlineImage-right").addClass("inlineImage-"+d).show()),this._showOverlay(d)},_handleLeaveEvent:function(b,c){var d;return d=function(){if(!a("div.trashcan",c.helper).length)return a(c.helper).append(a('<div class="trashcan"></div>')),a(".bigOverlay, .smallOverlay").remove()},window.waitWithTrash=setTimeout(d,200),this._removeFeedbackElements()},_handleStartEvent:function(b,c){var d;return d=this._checkOrigin(b),d&&a(b.target).remove(),a(document).trigger("startPreventSave"),this.options.startPlace=a(b.target)},_handleStopEvent:function(b,c){var d;return d=this._checkOrigin(b),d?a(b.target).remove():a(this.options.editable.element).trigger("change"),this.overlay.big.hide(),this.overlay.left.hide(),this.overlay.right.hide(),a(document).trigger("stopPreventSave")},_handleDropEvent:function(b,c){var d,e,f,g;return d=a(this.options.editable.element),f=this._checkOrigin(b),g=this._calcDropPosition(this.options.offset,b),this._removeFeedbackElements(),this._removeCustomHelper(),e=this._createInsertElement(c.draggable[0],!1),g==="middle"?(e.show(),e.removeClass("inlineImage-middle inlineImage-left inlineImage-right"),e.addClass("inlineImage-"+g).css({position:"relative",left:(d.width()+parseFloat(d.css("paddingLeft"))+parseFloat(d.css("paddingRight"))-e.attr("width"))/2}),e.insertBefore(a(b.target))):(e.removeClass("inlineImage-middle inlineImage-left inlineImage-right"),e.addClass("inlineImage-"+g),e.css("display","block"),a(b.target).prepend(e)),this.overlay.big.hide(),this.overlay.left.hide(),this.overlay.right.hide(),d.trigger("change"),this._initImage(d)},_createHelper:function(b){return a("<div>").css({backgroundImage:"url("+a(b.currentTarget).attr("src")+")"}).addClass("customHelper").appendTo("body")},_initDraggable:function(b,c){var d;return d=this,b.jquery_draggable_initialized||(b.jquery_draggable_initialized=!0,a(b).draggable({cursor:"move",helper:function(a){return d._createHelper(a)},drag:function(a,b){return d._handleDragEvent(a,b)},start:function(a,b){return d._handleStartEvent(a,b)},stop:function(a,b){return d._handleStopEvent(a,b)},disabled:!c.hasClass("inEditMode"),cursorAt:{top:50,left:50}})),d.options.draggables.push(b)},_initImage:function(b){var c;return c=this,a(".rotationWrapper img",this.options.dialog).each(function(a,d){return c._initDraggable(d,b)})},_enableDragging:function(){return a.each(this.options.draggables,function(b,c){return a(c).draggable("option","disabled",!1)})},_disableDragging:function(){return a.each(this.options.draggables,function(b,c){return a(c).draggable("option","disabled",!0)})}})}(jQuery),function(a){return a.widget("IKS.halloimageupload",{options:{uploadCallback:null,uploadUrl:null,imageWidget:null,entity:null},_create:function(){return this.element.html('        <form class="upload">          <input type="file" class="file" name="userfile" accept="image/*" />          <input type="hidden" name="tags" value="" />          <button class="uploadSubmit">Upload</button>        </form>      ')},_init:function(){var b;return b=this,b.options.uploadUrl&&!b.options.uploadCallback&&(b.options.uploadCallback=b._iframeUpload),a(".uploadSubmit",this.element).bind("click",function(a){return a.preventDefault(),a.stopPropagation(),b.options.uploadCallback({widget:b,success:function(a){return b.options.imageWidget.setCurrent({url:a,label:""})}})})},_prepareIframe:function(b){var c,d;return d=(""+b.widgetName+"_postframe_"+b.options.uuid).replace(/-/g,"_"),c=a("#"+d),c.length?c:(c=a('<iframe name="'+d+'" id="'+d+'" class="hidden" style="display:none" />'),this.element.append(c),c.get(0).name=d,c)},_iframeUpload:function(b){var c,d,e,f;return f=b.widget,c=f._prepareIframe(f),d=a("form.upload",f.element),typeof f.options.uploadUrl=="function"?e=f.options.uploadUrl(f.options.entity):e=f.options.uploadUrl,c.bind("load",function(){var a;return a=c.get(0).contentWindow.location.href,f.element.hide(),b.success(a)}),d.attr("action",e),d.attr("method","post"),d.attr("target",c.get(0).name),d.attr("enctype","multipart/form-data"),d.attr("encoding","multipart/form-data"),d.submit()}})}(jQuery),function(a){return a.widget("IKS.halloimagesearch",{options:{imageWidget:null,searchCallback:null,searchUrl:null,limit:5},_create:function(){return this.element.html('<div>        <form method="get">          <input type="text" class="searchInput" />          <input type="submit" class="btn searchButton" value="OK" />        </form>        <div class="searchResults imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){var b;return b=this,b.options.searchUrl&&!b.options.searchCallback&&(b.options.searchCallback=b._ajaxSearch),a(".activitySpinner",this.element).hide(),a("form",this.element).submit(function(c){var d;return c.preventDefault(),a(".activitySpinner",this.element).show(),d=a(".searchInput",b.element).val(),b.options.searchCallback(d,b.options.limit,0,function(a){return b._showResults(a)})})},_showResult:function(b){var c,d=this;return b.label||(b.label=b.alt),c=a('<li><img src="'+b.url+'" class="imageThumbnail" title="'+b.label+'"></li>'),c.bind("click",function(){return d.options.imageWidget.setCurrent(b)}),a("img",c).bind("mousedown",function(a){return a.preventDefault(),d.options.imageWidget.setCurrent(b)}),a(".imageThumbnailContainer ul",this.element).append(c)},_showNextPrev:function(b){var c,d;return d=this,c=a("imageThumbnailContainer ul",this.element),c.prepend(a('<div class="pager-prev" style="display:none"></div>')),c.append(a('<div class="pager-next" style="display:none"></div>')),b.offset>0&&a(".pager-prev",c).show(),b.offset<b.total&&a(".pager-next",c).show(),a(".pager-prev",c).click(function(a){return d.options.searchCallback(query,d.options.limit,response.offset-d.options.limit,function(a){return d._showResults(a)})}),a(".pager-next",c).click(function(a){return d.options.searchCallback(query,d.options.limit,response.offset+d.options.limit,function(a){return d._showResults(a)})})},_showResults:function(b){var c,d,e,f;a(".activitySpinner",this.element).hide(),a(".imageThumbnailContainer ul",this.element).empty(),a(".imageThumbnailContainer ul",this.element).show(),f=b.assets;for(d=0,e=f.length;d<e;d++)c=f[d],this._showResult(c);return this.options.imageWidget.setCurrent(b.assets.shift()),this._showNextPrev(b)},_ajaxSearch:function(b,c,d,e){var f;return f=this.searchUrl+"?"+a.param({q:b,limit:c,offset:d}),a.getJSON(f,e)}})}(jQuery),function(a){return a.widget("IKS.halloimagesuggestions",{loaded:!1,options:{entity:null,vie:null,dbPediaUrl:null,getSuggestions:null},_create:function(){return this.element.html('      <div id="'+this.options.uuid+'-tab-suggestions">        <div class="imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){return a(".activitySpinner",this.element).hide()},_normalizeRelated:function(a){return _.isString(a)?a:_.isArray(a)?a.join(","):a.pluck("@subject").join(",")},_prepareVIE:function(){this.options.vie||(this.options.vie=new VIE);if(this.options.vie.services.dbpedia)return;if(!this.options.dbPediaUrl)return;return this.options.vie.use(new vie.DBPediaService({url:this.options.dbPediaUrl,proxyDisabled:!0}))},_getSuggestions:function(){var b,c;if(this.loaded)return;if(!this.options.entity)return;a(".activitySpinner",this.element).show(),c=this.options.entity.get("skos:related");if(c.length===0){a("#activitySpinner").html("No images found.");return}return a(".imageThumbnailContainer ul",this.element).empty(),b=this._normalizeRelated(c),this.options.getSuggestions&&this.options.getSuggestions(b,widget.options.limit,0,this._showSuggestions),this._prepareVIE(),this.options.vie.services.dbpedia&&this._getSuggestionsDbPedia(c),this.loaded=!0},_getSuggestionsDbPedia:function(b){var c,d;return d=this,c=1,_.each(b,function(b){return vie.load({entity:b}).using("dbpedia").execute().done(function(c){return a(".activitySpinner",this.element).hide(),_.each(c,function(a){var c,e;e=a.attributes["<http://dbpedia.org/ontology/thumbnail>"];if(!e)return;return _.isObject(e)&&(c=e[0].value),_.isString(e)&&(c=d.options.entity.fromReference(e)),d._showSuggestion({url:c,label:b})})})})},_showSuggestion:function(b){var c,d=this;return c=a('<li><img src="'+b.url+'" class="imageThumbnail" title="'+b.label+'"></li>'),c.bind("click",function(){return d.options.imageWidget.setCurrent(b)}),a(".imageThumbnailContainer ul",this.element).append(c)},_showSuggestions:function(b){var c=this;return a(".activitySpinner",this.element).hide(),_.each(b,function(a){return c._showSuggestion(a)})}})}(jQuery),function(a){return a.widget("Liip.hallotoolbarlinebreak",{options:{editable:null,uuid:"",breakAfter:[]},populateToolbar:function(b){var c,d,e,f,g,h,i,j,k,l;d=a(".ui-buttonset",b),e=a(),g=0,l=this.options.breakAfter;for(h=0,j=l.length;h<j;h++){f=l[h],g++;for(i=0,k=d.length;i<k;i++){c=d[i],e=a(e).add(a(c));if(a(c).hasClass(f)){e.wrapAll('<div class="halloButtonrow halloButtonrow-'+g+'" />'),d=d.not(e),e=a();break}}}if(d.length>0)return g++,d.wrapAll('<div class="halloButtonrow halloButtonrow-'+g+'" />')},_init:function(){}})}(jQuery),function(a){var b;return b=null,this.VIE!==void 0&&(b=new VIE,b.use(new b.StanbolService({proxyDisabled:!0,url:"http://dev.iks-project.eu:8081"}))),a.widget("IKS.halloannotate",{options:{vie:b,editable:null,toolbar:null,uuid:"",select:function(){},decline:function(){},remove:function(){},buttonCssClass:null},_create:function(){var b,c,d;d=this;if(this.options.vie===void 0)throw"The halloannotate plugin requires VIE to be loaded";if(typeof this.element.annotate!="function")throw"The halloannotate plugin requires annotate.js to be loaded";return this.state="off",this.instantiate(),c=function(){var b;return b=this,a(b).halloannotate("turnOff")},b=this.options.editable.element,b.bind("hallodisabled",c)},populateToolbar:function(b){var c,d=this;return c=a('<span class="'+this.widgetName+'"></span>'),this.button=c.hallobutton({label:"Annotate",icon:"icon-tags",editable:this.options.editable,command:null,uuid:this.options.uuid,cssClass:this.options.buttonCssClass,queryState:!1}),c.bind("change",function(a){if(d.state==="pending")return;return d.state==="off"?d.turnOn():d.turnOff()}),c.buttonset(),b.append(this.button)},cleanupContentClone:function(b){if(this.state==="on")return b.find(".entity:not([about])").each(function(){return a(this).replaceWith(a(this).html())})},instantiate:function(){var b;return b=this,this.options.editable.element.annotate({vie:this.options.vie,debug:!1,showTooltip:!0,select:this.options.select,remove:this.options.remove,success:this.options.success,error:this.options.error}).bind("annotateselect",function(a,c){return b.options.editable.setModified()}).bind("annotateremove",function(){return a.noop()})},turnPending:function(){return this.state="pending",this.button.hallobutton("checked",!1),this.button.hallobutton("disable")},turnOn:function(){var a,b=this;this.turnPending(),a=this;try{return this.options.editable.element.annotate("enable",function(a){if(a)return b.state="on",b.button.hallobutton("checked",!0),b.button.hallobutton("enable")})}catch(c){return alert(c)}},turnOff:function(){this.options.editable.element.annotate("disable"),this.state="off";if(!this.button)return;return this.button.attr("checked",!1),this.button.find("label").removeClass("ui-state-clicked"),this.button.button("refresh")}})}(jQuery),function(a){return a.widget("Liip.halloimage",{options:{editable:null,toolbar:null,uuid:"",limit:8,search:null,searchUrl:null,suggestions:null,loaded:null,upload:null,uploadUrl:null,dialogOpts:{autoOpen:!1,width:270,height:"auto",title:"Insert Images",modal:!1,resizable:!1,draggable:!0,dialogClass:"halloimage-dialog"},dialog:null,buttonCssClass:null,entity:null,vie:null,dbPediaUrl:"http://dev.iks-project.eu/stanbolfull",maxWidth:250,maxHeight:250},populateToolbar:function(b){var c,d,e,f,g;return this.options.toolbar=b,g=this,e=""+this.options.uuid+"-image-dialog",this.options.dialog=a('<div id="'+e+'">                <div class="nav">                    <ul class="tabs">                    </ul>                    <div id="'+this.options.uuid+'-tab-activeIndicator" class="tab-activeIndicator" />                </div>                <div class="dialogcontent">            </div>'),g.options.suggestions&&this._addGuiTabSuggestions(a(".tabs",this.options.dialog),a(".dialogcontent",this.options.dialog)),(g.options.search||g.options.searchUrl)&&this._addGuiTabSearch(a(".tabs",this.options.dialog),a(".dialogcontent",this.options.dialog)),(g.options.upload||g.options.uploadUrl)&&this._addGuiTabUpload(a(".tabs",this.options.dialog),a(".dialogcontent",this.options.dialog)),this.current=a('<div class="currentImage"></div>').halloimagecurrent({uuid:this.options.uuid,imageWidget:this,editable:this.options.editable,dialog:this.options.dialog,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight}),a(".dialogcontent",this.options.dialog).append(this.current),d=a('<span class="'+g.widgetName+'"></span>'),f=""+this.options.uuid+"-image",c=a("<span></span>"),c.hallobutton({label:"Images",icon:"icon-picture",editable:this.options.editable,command:null,queryState:!1,uuid:this.options.uuid,cssClass:this.options.buttonCssClass}),d.append(c),this.button=c,this.button.bind("click",function(a){return g.options.dialog.dialog("isOpen")?g._closeDialog():g._openDialog(),!1}),this.options.editable.element.bind("hallodeactivated",function(a){return g._closeDialog()}),a(this.options.editable.element).delegate("img","click",function(a){return g._openDialog()}),d.buttonset(),b.append(d),this.options.dialog.dialog(this.options.dialogOpts),this._handleTabs()},setCurrent:function(a){return this.current.halloimagecurrent("setImage",a)},_handleTabs:function(){var b;return b=this,a(".nav li",this.options.dialog).bind("click",function(){var c;return a("."+b.widgetName+"-tab").hide(),c=a(this).attr("id"),a("#"+c+"-content").show(),a("#"+b.options.uuid+"-tab-activeIndicator").css("margin-left",a(this).position().left+a(this).width()/2)}),a(".nav li",this.options.dialog).first().click()},_openDialog:function(){var b,c,d,e,f=this;return c=this,b=function(){return window.setTimeout(function(){var b;return b=a(".imageThumbnail"),a(b).each(function(){var b;b=a("#"+this.id).width();if(b<=20)return a("#"+this.id).parent("li").remove()})},15e3)},a("#"+this.options.uuid+"-sugg-activeImage").attr("src",a("#"+this.options.uuid+"-tab-suggestions-content .imageThumbnailActive").first().attr("src")),a("#"+this.options.uuid+"-sugg-activeImageBg").attr("src",a("#"+this.options.uuid+"-tab-suggestions-content .imageThumbnailActive").first().attr("src")),this.lastSelection=this.options.editable.getSelection(),d=a(this.options.editable.element).offset().left+a(this.options.editable.element).outerWidth()-3,e=a(this.options.toolbar).offset().top-a(document).scrollTop()-29,this.options.dialog.dialog("option","position",[d,e]),b(),c.options.loaded=1,this.options.editable.keepActivated(!0),this.options.dialog.dialog("open"),this.options.dialog.bind("dialogclose",function(){return a("label",f.button).removeClass("ui-state-active"),f.options.editable.element.focus(),f.options.editable.keepActivated(!1)})},_closeDialog:function(){return this.options.dialog.dialog("close")},_addGuiTabSuggestions:function(b,c){var d;return b.append(a('<li id="'+this.options.uuid+'-tab-upload" class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-upload"><span>Upload</span></li>')),d=a('<div id="'+this.options.uuid+'-tab-upload-content" class="'+this.widgetName+'-tab tab-upload"></div>'),c.append(d),d.halloimagesuggestions({uuid:this.options.uuid,imageWidget:this,entity:this.options.entity})},_addGuiTabSearch:function(b,c){var d,e,f;return f=this,d=""+this.options.uuid+"-image-dialog",b.append(a('<li id="'+this.options.uuid+'-tab-search" class="'+
f.widgetName+"-tabselector "+f.widgetName+'-tab-search"><span>Search</span></li>')),e=a('<div id="'+this.options.uuid+'-tab-search-content" class="'+f.widgetName+'-tab tab-search"></div>'),c.append(e),e.halloimagesearch({uuid:this.options.uuid,imageWidget:this,searchCallback:this.options.search,searchUrl:this.options.searchUrl,limit:this.options.limit,entity:this.options.entity})},_addGuiTabUpload:function(b,c){var d;return b.append(a('<li id="'+this.options.uuid+'-tab-upload" class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-upload"><span>Upload</span></li>')),d=a('<div id="'+this.options.uuid+'-tab-upload-content" class="'+this.widgetName+'-tab tab-upload"></div>'),c.append(d),d.halloimageupload({uuid:this.options.uuid,uploadCallback:this.options.upload,uploadUrl:this.options.uploadUrl,imageWidget:this,entity:this.options.entity})}})}(jQuery),function(a){return a.widget("IKS.halloformat",{options:{editable:null,uuid:"",formattings:{bold:!0,italic:!0,strikeThrough:!1,underline:!1},buttonCssClass:null},populateToolbar:function(b){var c,d,e,f,g,h,i=this;g=this,d=a('<span class="'+g.widgetName+'"></span>'),c=function(b){var c;return c=a("<span></span>"),c.hallobutton({label:b,editable:i.options.editable,command:b,uuid:i.options.uuid,cssClass:i.options.buttonCssClass}),d.append(c)},h=this.options.formattings;for(f in h)e=h[f],e&&c(f);return d.hallobuttonset(),b.append(d)}})}(jQuery),function(a){return a.widget("IKS.halloreundo",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(b){var c,d,e=this;return d=a('<span class="'+this.widgetName+'"></span>'),c=function(b,c){var f;return f=a("<span></span>"),f.hallobutton({uuid:e.options.uuid,editable:e.options.editable,label:c,icon:b==="undo"?"icon-undo":"icon-repeat",command:b,queryState:!1,cssClass:e.options.buttonCssClass}),d.append(f)},c("undo","Undo"),c("redo","Redo"),d.hallobuttonset(),b.append(d)},_init:function(){}})}(jQuery),function(a){return a.widget("IKS.halloblock",{options:{editable:null,toolbar:null,uuid:"",elements:["h1","h2","h3","p","pre","blockquote"],buttonCssClass:null},populateToolbar:function(b){var c,d,e;return c=a('<span class="'+this.widgetName+'"></span>'),d=""+this.options.uuid+"-"+this.widgetName+"-data",e=this._prepareDropdown(d),c.append(e),c.append(this._prepareButton(e)),b.append(c)},_prepareDropdown:function(b){var c,d,e,f,g,h,i,j=this;e=a('<div id="'+b+'"></div>'),d=this.options.editable.element.get(0).tagName.toLowerCase(),c=function(b){var c,e;return c=a("<button class='blockselector'><"+b+' class="menu-item">'+b+"</"+b+"></button>"),d===b&&c.addClass("selected"),d!=="div"&&c.addClass("disabled"),c.bind("click",function(){if(c.hasClass("disabled"))return;return a.browser.msie?j.options.editable.execute("FormatBlock","<"+b.toUpperCase()+">"):j.options.editable.execute("formatBlock",b.toUpperCase())}),e=function(a){var d;d=document.queryCommandValue("formatBlock");if(d.toLowerCase()===b){c.addClass("selected");return}return c.removeClass("selected")},j.options.editable.element.bind("halloenabled",function(){return j.options.editable.element.bind("keyup paste change mouseup",e)}),j.options.editable.element.bind("hallodisabled",function(){return j.options.editable.element.unbind("keyup paste change mouseup",e)}),c},i=this.options.elements;for(g=0,h=i.length;g<h;g++)f=i[g],e.append(c(f));return e},_prepareButton:function(b){var c;return c=a("<span></span>"),c.hallodropdownbutton({uuid:this.options.uuid,editable:this.options.editable,label:"block",icon:"icon-text-height",target:b,cssClass:this.options.buttonCssClass}),c}})}(jQuery),function(a){return a.widget("IKS.hallolink",{options:{editable:null,uuid:"",link:!0,image:!0,defaultUrl:"http://",dialogOpts:{autoOpen:!1,width:540,height:95,title:"Enter Link",modal:!0,resizable:!1,draggable:!1,dialogClass:"hallolink-dialog"},butonCssClass:null},populateToolbar:function(b){var c,d,e,f,g,h,i,j=this;i=this,f=""+this.options.uuid+"-dialog",e=a('<div id="'+f+'"><form action="#" method="post" class="linkForm"><input class="url" type="text" name="url" value="'+this.options.defaultUrl+'" /><input type="submit" id="addlinkButton" value="Insert" /></form></div>'),h=a("input[name=url]",e).focus(function(a){return this.select()}),g=function(a){var b;return a.preventDefault(),b=h.val(),i.options.editable.restoreSelection(i.lastSelection),(new RegExp(/^\s*$/)).test(b)||b===i.options.defaultUrl?(i.lastSelection.collapsed&&(i.lastSelection.setStartBefore(i.lastSelection.startContainer),i.lastSelection.setEndAfter(i.lastSelection.startContainer),window.getSelection().addRange(i.lastSelection)),document.execCommand("unlink",null,"")):i.lastSelection.startContainer.parentNode.href===void 0?document.execCommand("createLink",null,b):i.lastSelection.startContainer.parentNode.href=b,i.options.editable.element.trigger("change"),i.options.editable.removeAllSelections(),e.dialog("close"),!1},e.find("form").submit(g),d=a('<span class="'+i.widgetName+'"></span>'),c=function(b){var c,f,g;return g=""+j.options.uuid+"-"+b,f=a("<span></span>"),f.hallobutton({label:"Link",icon:"icon-link",editable:j.options.editable,command:null,queryState:!1,uuid:j.options.uuid,cssClass:j.options.buttonCssClass}),d.append(f),c=f,c.bind("click",function(b){return i.lastSelection=i.options.editable.getSelection(),h=a("input[name=url]",e),i.lastSelection.startContainer.parentNode.href===void 0?h.val(i.options.defaultUrl):(h.val(a(i.lastSelection.startContainer.parentNode).attr("href")),a(h[0].form).find("input[type=submit]").val("update")),i.options.editable.keepActivated(!0),e.dialog("open"),e.bind("dialogclose",function(){return a("label",f).removeClass("ui-state-active"),i.options.editable.element.focus(),i.options.editable.keepActivated(!1)}),!1}),j.element.bind("keyup paste change mouseup",function(b){var d,e;e=a(i.options.editable.getSelection().startContainer),d=e.prop("nodeName")?e.prop("nodeName"):e.parent().prop("nodeName");if(d&&d.toUpperCase()==="A"){a("label",c).addClass("ui-state-active");return}return a("label",c).removeClass("ui-state-active")})},this.options.link&&c("A");if(this.options.link)return d.buttonset(),b.append(d),e.dialog(this.options.dialogOpts)},_init:function(){}})}(jQuery),function(a){return a.widget("IKS.hallojustify",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(b){var c,d,e=this;return d=a('<span class="'+this.widgetName+'"></span>'),c=function(b){var c;return c=a("<span></span>"),c.hallobutton({uuid:e.options.uuid,editable:e.options.editable,label:b,command:"justify"+b,icon:"icon-align-"+b.toLowerCase(),cssClass:e.options.buttonCssClass}),d.append(c)},c("Left"),c("Center"),c("Right"),d.hallobuttonset(),b.append(d)},_init:function(){}})}(jQuery),function(a){return a.widget("IKS.hallobutton",{button:null,isChecked:!1,options:{uuid:"",label:null,icon:null,editable:null,command:null,queryState:!0,cssClass:null},_create:function(){var a,b,c,d,e=this;return(d=(c=this.options).icon)==null&&(c.icon="icon-"+this.options.label.toLowerCase()),b=""+this.options.uuid+"-"+this.options.label,this.button=this._createButton(b,this.options.command,this.options.label,this.options.icon),this.element.append(this.button),this.options.cssClass&&this.button.addClass(this.options.cssClass),this.options.editable.options.touchScreen&&this.button.addClass("btn-large"),this.button.data("hallo-command",this.options.command),a="ui-state-hover",this.button.bind("mouseenter",function(b){if(e.isEnabled())return e.button.addClass(a)}),this.button.bind("mouseleave",function(b){return e.button.removeClass(a)})},_init:function(){var a,b,c=this;this.button||(this.button=this._prepareButton()),this.element.append(this.button),b=function(a){if(!c.options.command)return;try{return c.checked(document.queryCommandState(c.options.command))}catch(b){}},this.options.command&&this.button.bind("click",function(a){return c.options.editable.execute(c.options.command),b,!1});if(!this.options.queryState)return;return a=this.options.editable.element,a.bind("keyup paste change mouseup hallomodified",b),a.bind("halloenabled",function(){return a.bind("keyup paste change mouseup hallomodified",b)}),a.bind("hallodisabled",function(){return a.unbind("keyup paste change mouseup hallomodified",b)})},enable:function(){return this.button.removeAttr("disabled")},disable:function(){return this.button.attr("disabled","true")},isEnabled:function(){return this.button.attr("disabled")!=="true"},refresh:function(){return this.isChecked?this.button.addClass("ui-state-active"):this.button.removeClass("ui-state-active")},checked:function(a){return this.isChecked=a,this.refresh()},_createButton:function(b,c,d,e){return a('<button for="'+b+'" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only '+c+'_button" title="'+d+'"><span class="ui-button-text"><i class="'+e+'"></i></span></button>')}}),a.widget("IKS.hallobuttonset",{buttons:null,_create:function(){return this.element.addClass("ui-buttonset")},_init:function(){return this.refresh()},refresh:function(){var a;return a=this.element.css("direction")==="rtl",this.buttons=this.element.find(".ui-button"),this.buttons.hallobutton("refresh"),this.buttons.removeClass("ui-corner-all ui-corner-left ui-corner-right"),this.buttons.filter(":first").addClass(a?"ui-corner-right":"ui-corner-left"),this.buttons.filter(":last").addClass(a?"ui-corner-left":"ui-corner-right")}})}(jQuery),function(a){return a.widget("IKS.hallodropdownbutton",{button:null,options:{uuid:"",label:null,icon:null,editable:null,target:"",cssClass:null},_create:function(){var a,b;return(b=(a=this.options).icon)!=null?b:a.icon="icon-"+this.options.label.toLowerCase()},_init:function(){var b,c=this;return b=a(this.options.target),b.css("position","absolute"),b.addClass("dropdown-menu"),b.hide(),this.button||(this.button=this._prepareButton()),this.button.bind("click",function(){if(b.hasClass("open")){c._hideTarget();return}return c._showTarget()}),b.bind("click",function(){return c._hideTarget()}),this.options.editable.element.bind("hallodeactivated",function(){return c._hideTarget()}),this.element.append(this.button)},_showTarget:function(){var b;return b=a(this.options.target),this._updateTargetPosition(),b.addClass("open"),b.show()},_hideTarget:function(){var b;return b=a(this.options.target),b.removeClass("open"),b.hide()},_updateTargetPosition:function(){var b,c,d,e;return c=a(this.options.target),e=this.button.position(),d=e.top,b=e.left,d+=this.button.outerHeight(),c.css("top",d),c.css("left",b-20)},_prepareButton:function(){var b,c,d;return d=""+this.options.uuid+"-"+this.options.label,c=a('<button id="'+d+'" data-toggle="dropdown" data-target="#'+this.options.target.attr("id")+'" title="'+this.options.label+'">\n  <span class="ui-button-text"><i class="'+this.options.icon+'"></i></span>\n</button>'),this.options.cssClass&&c.addClass(this.options.cssClass),b=c.button(),b}})}(jQuery),function(a){return a.widget("Hallo.halloToolbarContextual",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null},_create:function(){var b=this;return this.toolbar=this.options.toolbar,a(this.options.parentElement).append(this.toolbar),this._bindEvents(),a(window).resize(function(a){return b._updatePosition(b._getPosition(a))})},_getPosition:function(a,b){var c,d;if(!a)return;c=a.type;if(c==="keydown"||c==="keyup"||c==="keypress")return this._getCaretPosition(b);if(c==="click"||c==="mousedown"||c==="mouseup")return d={top:a.pageY,left:a.pageX}},_getCaretPosition:function(b){var c,d,e;return e=a("<span/>"),c=rangy.createRange(),c.setStart(b.endContainer,b.endOffset),c.insertNode(e.get(0)),d={top:e.offset().top,left:e.offset().left},e.remove(),d},setPosition:function(){return this.options.parentElement!=="body"&&(this.options.parentElement="body",a(this.options.parentElement).append(this.toolbar)),this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-20),this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(a){if(!a)return;if(!a.top||!a.left)return;return this.toolbar.css("top",a.top),this.toolbar.css("left",a.left)},_bindEvents:function(){var a=this;return this.element.bind("halloselected",function(b,c){var d;d=a._getPosition(c.originalEvent,c.selection);if(!d)return;return a._updatePosition(d),a.toolbar.show()}),this.element.bind("hallounselected",function(b,c){return a.toolbar.hide()}),this.element.bind("hallodeactivated",function(b,c){return a.toolbar.hide()})}})}(jQuery),function(a){return a.widget("Hallo.halloToolbarFixed",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null},_create:function(){var b,c,d=this;this.toolbar=this.options.toolbar,this.toolbar.show(),a(this.options.parentElement).append(this.toolbar),this._bindEvents(),a(window).resize(function(a){return d._updatePosition(d._getPosition(a))});if(this.options.parentElement==="body"&&!this.options.floating)return b=a(this.element),c=parseFloat(b.css("padding-left")),c+=parseFloat(b.css("padding-right")),c+=parseFloat(b.css("border-left-width")),c+=parseFloat(b.css("border-right-width")),c+=parseFloat(b.css("outline-width"))*2,c+=parseFloat(b.css("outline-offset"))*2,a(this.toolbar).css("width",b.width()+c)},_getPosition:function(a,b){var c,d;if(!a)return;return c=parseFloat(this.element.css("outline-width"))+parseFloat(this.element.css("outline-offset")),d={top:this.element.offset().top-this.toolbar.outerHeight()-c,left:this.element.offset().left-c}},_getCaretPosition:function(b){var c,d,e;return e=a("<span/>"),c=rangy.createRange(),c.setStart(b.endContainer,b.endOffset),c.insertNode(e.get(0)),d={top:e.offset().top,left:e.offset().left},e.remove(),d},setPosition:function(){if(this.options.parentElement!=="body")return;return this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-this.toolbar.outerHeight()),this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(a){},_bindEvents:function(){var a=this;return this.element.bind("halloactivated",function(b,c){return a._updatePosition(a._getPosition(b)),a.toolbar.show()}),this.element.bind("hallodeactivated",function(b,c){return a.toolbar.hide()})}})}(jQuery)})).call(this);